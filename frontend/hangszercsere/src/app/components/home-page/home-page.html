<div class="p-4">
  <app-filter></app-filter>
</div>

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 p-4">
  
  <ng-container *ngIf="listings?.length == 0">
    <p class="text-light-text-secondary dark:text-text-secondary">Loading...</p>
  </ng-container>
  
  <div *ngFor="let listing of listings" class="product-card" routerLink="/listing" (click)="viewListing(listing.id); SetListing(listing);">
    
    <!-- Image + Price -->
    <div class="relative">
      <img [src]="'https://hangszercsere.hu/uploads/' + listing.images[0]" alt="Listing Image" class="w-full h-48 object-cover rounded-t-md">
      <span class="price-badge">{{ listing.price }} Ft</span>
      <span class="condition-badge left-2 top-2" [ngClass]="{
        'text-green-500 border-green-500': listing?.condition === 'New',
        'text-emerald-400 border-emerald-400': listing?.condition === 'Very Good',
        'text-yellow-500 border-yellow-500': listing?.condition === 'Good',
        'text-orange-500 border-orange-500': listing?.condition === 'Satisfactory'
      }">{{ listing?.condition }}</span>
    </div>
    
    <!-- Title  -->
    <div class="product-title mt-2 font-semibold text-lg line-clamp-1">
      {{ listing.title }}
    </div>
    
    <!-- Description (limited to 2 lines for cleaner UX) -->
    <div class="product-description mt-1 text-sm text-light-text-secondary dark:text-text-secondary line-clamp-2">
      {{ listing.description }}
    </div>
    
    <!-- Meta info -->
    <div class="product-meta mt-2 text-xs text-light-text-secondary dark:text-text-secondary flex justify-between">
      <span>Seller: {{ listing.seller }}</span>
      <span>Category: {{ listing.category }}</span>
    </div>
    
    <!-- Time since posted -->
    <div class="px-4 mt-1 text-xs text-light-text-muted flex justify-between dark:text-text-muted">
      <span>{{ listing.created_at | timeAgo }}</span> <!-- Angular pipe to convert date to "1 day ago" -->
    </div>
    
    <!-- Add to cart -->
    <div class="px-4 pb-4 mt-2">
      <ng-container *ngIf="listing.user_id != this.user.getUserId()">
        <a (click)="AddToCart(listing.id)" class="hover-button">
          Add to cart
        </a>
      </ng-container>
    </div>
    
  </div>
</div>
